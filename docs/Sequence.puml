@startuml
actor 사용자
participant "공연" as 공연
participant "유저" as 유저
participant "대기열" as 대기열
participant "포인트" as 포인트
participant "예약" as 예약
participant "좌석" as 락
participant "결제 서비스" as 결제

== 공연 / 공연장 / 날짜 선택 ==
사용자 -> 공연 : 공연 목록 조회
공연 --> 사용자 : 공연 리스트

사용자 -> 공연 : 공연장 목록 조회
공연 --> 사용자 : 공연장 리스트

사용자 -> 공연 : 해당 공연장의 날짜 목록 조회
공연 --> 사용자 : 날짜 리스트

사용자 -> 유저 : 전화번호 입력 → UUID 확인 or 발급
유저 --> 사용자 : UUID 반환

== 대기열 등록 ==
사용자 -> 대기열 : 대기열 등록 요청 (공연ID, 공연장ID, 날짜, UUID)
대기열 -> 포인트 : 잔액 확인
포인트 --> 대기열 : 충분함
대기열 --> 사용자 : 대기열 토큰 발급

== 좌석 예약 ==
사용자 -> 예약 : 좌석 예약 요청 (좌석번호들 + 토큰)
예약 -> 대기열 : 토큰 유효성 확인
대기열 --> 예약 : OK
예약 -> 락 : 좌석 임시 점유 (3분 타이머 시작)
락 --> 예약 : 점유 성공
예약 --> 사용자 : 임시 예약 완료

== 결제 ==
사용자 -> 결제 : 결제 요청
결제 -> 대기열 : 토큰 유효성 확인
결제 -> 포인트 : 잔액 차감
포인트 -> 포인트 : 포인트 내역 기록
결제 -> 예약 : 예약 상태 확정
예약 -> 락 : 좌석 상태 확정
결제 -> 대기열 : 토큰 만료
결제 --> 사용자 : 결제 성공 응답

@enduml